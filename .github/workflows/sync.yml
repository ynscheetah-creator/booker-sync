name: Notion Booker Sync

on:
  # 1. ZamanlanmÄ±ÅŸ GÃ¶rev: Her 6 saatte bir otomatik Ã§alÄ±ÅŸtÄ±r (isteÄŸe baÄŸlÄ±)
  schedule:
    - cron: '0 */6 * * *'

  # 2. Manuel Tetikleme: GitHub Actions arayÃ¼zÃ¼nden elle Ã§alÄ±ÅŸtÄ±rma
  workflow_dispatch:
    inputs:
      scan_limit:
        description: 'Taranacak son sayfa sayÄ±sÄ± (boÅŸ bÄ±rakÄ±lÄ±rsa hepsi taranÄ±r)'
        required: false
        default: '' # BoÅŸ bÄ±rakÄ±ldÄ±ÄŸÄ±nda script tÃ¼mÃ¼nÃ¼ tarar

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Create virtual environment
        run: python -m venv .venv

      - name: Install dependencies
        run: |
          source .venv/bin/activate
          # Cache'i atlayarak ve force reinstall ile yÃ¼kle
          pip install --no-cache-dir --force-reinstall -r requirements.txt
          # YÃ¼klenen notion-client versiyonunu logla
          echo "ğŸ“¦ YÃ¼klenen notion-client versiyonu:"
          pip show notion-client
      
      - name: Run sync
        # Bu adÄ±m, script'i Ã§alÄ±ÅŸtÄ±rÄ±r.
        # GitHub Secrets'tan ve manuel input'tan gelen deÄŸerleri ortam deÄŸiÅŸkeni olarak ayarlar.
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          # YENÄ° SATIR: "Yeni" kayÄ±tlarÄ±n kaÃ§ saatlik olduÄŸunu belirler.
          NEW_ENTRY_HOURS: ${{ secrets.NEW_ENTRY_HOURS || '24' }}
          RECENT_EDIT_HOURS: ${{ secrets.RECENT_EDIT_HOURS || '24' }}
          # Manuel input'tan gelen deÄŸeri SCAN_LIMIT deÄŸiÅŸkenine ata
          SCAN_LIMIT: ${{ github.event.inputs.scan_limit }}
        run: |
          source .venv/bin/activate
          python main.py
