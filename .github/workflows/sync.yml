name: Notion Booker Sync

on:
  # 1. Zamanlanmış Görev: Her 6 saatte bir otomatik çalıştır (isteğe bağlı)
  schedule:
    - cron: '0 */6 * * *'

  # 2. Manuel Tetikleme: GitHub Actions arayüzünden elle çalıştırma
  workflow_dispatch:
    inputs:
      scan_limit:
        description: 'Taranacak son sayfa sayısı (boş bırakılırsa hepsi taranır)'
        required: false
        default: '' # Boş bırakıldığında script tümünü tarar

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # Kullandığınız Python sürümünü yazın

      - name: Create virtual environment
        run: python -m venv .venv

      - name: Install dependencies
        run: |
          source .venv/bin/activate
          pip install -r requirements.txt
      
      - name: Run sync
        # Bu adım, script'i çalıştırır.
        # GitHub Secrets'tan ve manuel input'tan gelen değerleri ortam değişkeni olarak ayarlar.
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          RECENT_EDIT_HOURS: ${{ secrets.RECENT_EDIT_HOURS || '24' }}
          # YENİ: Manuel input'tan gelen değeri SCAN_LIMIT değişkenine ata
          SCAN_LIMIT: ${{ github.event.inputs.scan_limit }}
        run: |
          source .venv/bin/activate
          python main.py
